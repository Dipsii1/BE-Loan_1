generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Role {
  id        Int       @id @default(autoincrement())
  nama_role String    @unique @db.VarChar(50)
  profiles  Profile[]

  @@map("roles")
}

model User {
  id           String              @id @db.Char(36)
  name         String              @db.VarChar(100)
  email        String              @unique
  no_phone     String?             @db.VarChar(25)
  agent_code   String?             @unique
  nasabah_code String?             @unique
  role_id      Int
  created_at   DateTime            @default(now())
  updated_at   DateTime            @updatedAt
  statuses     ApplicationStatus[]
  credits      CreditApplication[]
  role         Role                @relation(fields: [role_id], references: [id])

  @@index([role_id])
  @@map("profiles")
}

model CreditApplication {
  id             Int                 @id @default(autoincrement())
  kode_pengajuan String              @unique @db.VarChar(20)
  nik            String              @db.VarChar(20)
  nama_lengkap   String              @db.VarChar(150)
  alamat         String
  tanggal_lahir  DateTime            @db.Date
  email          String              @db.VarChar(150)
  jenis_kredit   JenisKredit
  plafond        Decimal             @db.Decimal(15, 2)
  jaminan        Jaminan
  tempat_lahir   String              @db.VarChar(100)
  profile_id     String              @db.Char(36)
  created_at     DateTime            @default(now())
  updated_at     DateTime            @updatedAt
  slas           ApplicationSLA[]
  statuses       ApplicationStatus[]
  profile        Profile             @relation(fields: [profile_id], references: [id])

  @@index([profile_id], map: "credit_application_profile_id_fkey")
  @@map("credit_application")
}

model ApplicationStatus {
  id             Int               @id @default(autoincrement())
  application_id Int
  status         StatusKredit
  catatan        String?
  created_at     DateTime          @default(now())
  changed_by     String            @db.Char(36)
  application    CreditApplication @relation(fields: [application_id], references: [id])
  profile        Profile           @relation(fields: [changed_by], references: [id])

  @@index([application_id], map: "application_status_application_id_fkey")
  @@index([changed_by], map: "application_status_changed_by_fkey")
  @@map("application_status")
}

model ApplicationSLA {
  id               Int               @id @default(autoincrement())
  application_id   Int
  from_status      StatusKredit
  to_status        StatusKredit
  start_time       DateTime
  end_time         DateTime
  duration_minutes Int
  catatan          String?
  created_at       DateTime          @default(now())
  application      CreditApplication @relation(fields: [application_id], references: [id], onDelete: Cascade)

  @@index([application_id])
  @@map("application_sla")
}

enum JenisKredit {
  KREDIT_PRODUKTIF
  MULTIGUNA
  KPR
  PENSIUN
}

enum Jaminan {
  SERTIFIKAT
  BPKB
  SK_PEGAWAI
}

enum StatusKredit {
  DIAJUKAN
  DIPROSES
  DITERIMA
  DITOLAK
}
